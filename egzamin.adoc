=== Import danych do bazy
Korzystam z danych REDDIT już zaimportowanych do bazy MongoDB (v3.07) i opisanych pod linkiem: https://github.com/leyas/NoSQL/blob/master/zaliczenie.adoc.

Zaimportowano 53 851 542 rekordów.

image::http://s3.postimg.org/7hu3ldo0z/8import_result.png[import result]

=== Wykonanie agregacji

==== 1. Spośród wszystkich wpisów wyszukamy 10 autorów którzy uzyskali najgorszy winik (score) w ciągu ostatniego miesiąca.

Odpowiedź:
```
wutshappening: -8900
dwimback: -5241
_PM_ME_YOUR_PROLAPSE: -5043
salmonhelmet: -3552
Andrea--Dworkin: -2450
serblop: -2410
fritzly: -2393
cwenham: -2235
MisterCannon: -2183
berylthranox4: -2153
```

a) JavaScript 
```
db.myColl.runCommand('aggregate', 
  {pipeline: [
		{ $group: { _id: "$author", score: { $sum: "$score" } } },
		{ $sort: { score: 1 } },
		{ $limit : 10 }
	], 
allowDiskUse: true})
```

b) Java (przy użyciu JavaDriver)
Agregacja w języku Java jest opisana tutaj: https://docs.mongodb.org/getting-started/java/aggregation/
```
AggregateIterable<Document> iterable = db.getCollection("myColl").aggregate(asList(
        new Document("$group", new Document("_id", "$author").append("score", new Document("$sum", "$score"))),
        new Document("$sort", new Document("score", 1)),
        new Document("$limit", 10));
```

c) Porównanie JavaScript i Java
|===
| Język | Czas | zużycie CPU | zużycie RAM

| JavaScript
| 14 min
| 20%
| 99%

| Java
| 20 min
| 40%
| 75%

|===

image::http://s13.postimg.org/8jr6lo0nr/1javascript.png[img]

==== 2. Ile średnio polubień dostaje post?

Odpowiedź:
```
~ 5.23
```
a) JavaScript
```
db.myColl.runCommand('aggregate', 
	{pipeline: [
		{ $group: { 
			_id: null, 
			avg: { $avg: "$ups" } 
			} 
		},
	], 
       	allowDiskUse: true})
```
b) Java
```
AggregateIterable<Document> iterable = db.getCollection("myColl").aggregate(asList(
        new Document("$group", new Document("_id", null).append("avg", new Document("$avg", "$ups"))));
```
c) Porównanie JavaScript i Java

|===
| Język | Czas | zużycie CPU | zużycie RAM

| JavaScript
| 11 min
| 20%
| 99%

| Java
| 18 min
| 60%
| 81%

|===

image::http://s11.postimg.org/gggnxjwgj/2javascript.png[img2]

==== 3. Ilu jest autorów wpisów ?
Odpowiedź:
```
6 317 738
```
a) JavaScript
```
db.myColl.runCommand('aggregate', 
        {pipeline: [
		{ $group: { 
			_id: "$author", 
			ilu_autorow: { $sum: 1 } 
			} 
		},
	], 
        allowDiskUse: true})
```
b) Java
```
AggregateIterable<Document> iterable = db.getCollection("myColl").aggregate(asList(
        new Document("$group", new Document("_id", "$author").append("ilu_autorow", new Document("$sum", 1))));
```
c) Porównanie JavaScript i Java

|===
| Język | Czas | zużycie CPU | zużycie RAM

| JavaScript
| 16 min
| 20%
| 99%

| Java
| 25 min
| 50%
| 73%

|===

image::http://s21.postimg.org/566wo5wwn/3javascript.png[img3]

==== 4. Ile wpisów jest oznaczonych jako napisanych przez mężczyznę?
Odpowiedź:
```
32373
```

a) JavaScript
```
db.myColl.aggregate( [
	{ $match: { 
		author_flair_text: "Male" 
	} },
	{ $group: {
        	  _id: null,
		  count: { $sum: 1 }
        }
     }
   
] )
```

b) Java
```
AggregateIterable<Document> iterable = db.getCollection("myColl").aggregate(asList(
        new Document("$group", new Document("_id", null).append("count", new Document("$sum", 1))));
```
c) Porównanie JavaScript i Java
|===
| Język | Czas | zużycie CPU | zużycie RAM

| JavaScript
| 15 min
| 10%
| 99%

| Java
| 21 min
| 52%
| 72%

|===

image::http://s27.postimg.org/mlwltj0cj/4javascript.png[img4]	
